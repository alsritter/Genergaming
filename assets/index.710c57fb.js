var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,a,n)=>(((t,a,n)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n})(t,"symbol"!=typeof a?a+"":a,n),n));import{T as a,m as n,r,a as l,b as o,d as i,p as s,c,e as u,f as d,g as E,o as _,h as f,E as p,i as h,j as y,w as A,k as C,l as D,F as L,n as m,q as g,t as b,s as U,u as O,v as T,x as I,y as K,z as V,A as v,B as P,C as F,D as x}from"./vendor.d1d4d144.js";function S(e){return t=>{e.canvasSize=t}}function M(e){return t=>{e.initPoint=t}}function k(e){return t=>{e.initPoint.x=t}}function N(e){return t=>{e.initPoint.y=t}}function w(e){return t=>{e.dragging=t}}function R(e){return t=>{e.currentLayer=t}}function Y(e){return t=>{e.showGrid=t}}function B(e){return t=>{e.showAxis=t}}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const H={KEY_CANCEL:3,KEY_HELP:6,KEY_BACK_SPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_RETURN:13,KEY_SHIFT:16,KEY_CONTROL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_PRINTSCREEN:44,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_CMD:91,KEY_RIGHT_CMD:92,KEY_CONTEXT_MENU:93,KEY_NUMPAD0:96,KEY_NUMPAD1:97,KEY_NUMPAD2:98,KEY_NUMPAD3:99,KEY_NUMPAD4:100,KEY_NUMPAD5:101,KEY_NUMPAD6:102,KEY_NUMPAD7:103,KEY_NUMPAD8:104,KEY_NUMPAD9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_F13:124,KEY_F14:125,KEY_F15:126,KEY_F16:127,KEY_F17:128,KEY_F18:129,KEY_F19:130,KEY_F20:131,KEY_F21:132,KEY_F22:133,KEY_F23:134,KEY_F24:135,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMICOLON:186,KEY_EQUALS:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_SLASH:191,KEY_BACK_QUOTE:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_QUOTE:222,KEY_FIREFOX_ENTER:14,KEY_FIREFOX_SEMICOLON:59,KEY_FIREFOX_EQUALS:61,KEY_FIREFOX_SEPARATOR:108,KEY_FIREFOX_META:224,VALUE_CANCEL:"Cancel",VALUE_HELP:"Help",VALUE_BACK_SPACE:"Backspace",VALUE_TAB:"Tab",VALUE_CLEAR:"Clear",VALUE_ENTER:"Enter",VALUE_RETURN:"Enter",VALUE_SHIFT:"Shift",VALUE_CONTROL:"Control",VALUE_ALT:"Alt",VALUE_PAUSE:"Pause",VALUE_CAPS_LOCK:"CapsLock",VALUE_ESCAPE:"Escape",VALUE_SPACE:" ",VALUE_PAGE_UP:"PageUp",VALUE_PAGE_DOWN:"PageDown",VALUE_END:"End",VALUE_HOME:"Home",VALUE_LEFT:"ArrowLeft",VALUE_UP:"ArrowUp",VALUE_RIGHT:"ArrowRight",VALUE_DOWN:"ArrowDown",VALUE_PRINTSCREEN:"PrintScreen",VALUE_INSERT:"Insert",VALUE_DELETE:"Delete",VALUE_0:"0",VALUE_1:"1",VALUE_2:"2",VALUE_3:"3",VALUE_4:"4",VALUE_5:"5",VALUE_6:"6",VALUE_7:"7",VALUE_8:"8",VALUE_9:"9",VALUE_A:"a",VALUE_B:"b",VALUE_C:"c",VALUE_D:"d",VALUE_E:"e",VALUE_F:"f",VALUE_G:"g",VALUE_H:"h",VALUE_I:"i",VALUE_J:"j",VALUE_K:"k",VALUE_L:"l",VALUE_M:"m",VALUE_N:"n",VALUE_O:"o",VALUE_P:"p",VALUE_Q:"q",VALUE_R:"r",VALUE_S:"s",VALUE_T:"t",VALUE_U:"u",VALUE_V:"v",VALUE_W:"w",VALUE_X:"x",VALUE_Y:"y",VALUE_Z:"z",VALUE_META:"Meta",VALUE_LEFT_CMD:"Meta",VALUE_RIGHT_CMD:"Meta",VALUE_CONTEXT_MENU:"ContextMenu",VALUE_NUMPAD0:"0",VALUE_NUMPAD1:"1",VALUE_NUMPAD2:"2",VALUE_NUMPAD3:"3",VALUE_NUMPAD4:"4",VALUE_NUMPAD5:"5",VALUE_NUMPAD6:"6",VALUE_NUMPAD7:"7",VALUE_NUMPAD8:"8",VALUE_NUMPAD9:"9",VALUE_MULTIPLY:"*",VALUE_ADD:"+",VALUE_SUBTRACT:"-",VALUE_DECIMAL:".",VALUE_DIVIDE:"/",VALUE_F1:"F1",VALUE_F2:"F2",VALUE_F3:"F3",VALUE_F4:"F4",VALUE_F5:"F5",VALUE_F6:"F6",VALUE_F7:"F7",VALUE_F8:"F8",VALUE_F9:"F9",VALUE_F10:"F10",VALUE_F11:"F11",VALUE_F12:"F12",VALUE_F13:"F13",VALUE_F14:"F14",VALUE_F15:"F15",VALUE_F16:"F16",VALUE_F17:"F17",VALUE_F18:"F18",VALUE_F19:"F19",VALUE_F20:"F20",VALUE_F21:"F21",VALUE_F22:"F22",VALUE_F23:"F23",VALUE_F24:"F24",VALUE_NUM_LOCK:"NumLock",VALUE_SCROLL_LOCK:"ScrollLock",VALUE_SEMICOLON:",",VALUE_EQUALS:":",VALUE_COMMA:",",VALUE_DASH:"-",VALUE_PERIOD:".",VALUE_SLASH:"/",VALUE_BACK_QUOTE:"`",VALUE_OPEN_BRACKET:"[",VALUE_BACK_SLASH:"\\",VALUE_CLOSE_BRACKET:"]",VALUE_QUOTE:"'",CODE_UNIDENTIFIED:"Unidentified",CODE_ESCAPE:"Escape",CODE_MINUS:"Minus",CODE_DASH:"Minus",CODE_EQUALS:"Equal",CODE_BACK_SPACE:"Backspace",CODE_TAB:"Tab",CODE_ENTER:"Enter",CODE_RETURN:"Enter",CODE_SHIFT_LEFT:"ShiftLeft",CODE_SHIFT_RIGHT:"ShiftRight",CODE_CONTROL_LEFT:"ControlLeft",CODE_CONTROL_RIGHT:"ControlRight",CODE_ALT_LEFT:"AltLeft",CODE_ALT_RIGHT:"AltRight",CODE_PAUSE:"Pause",CODE_CAPS_LOCK:"CapsLock",CODE_SPACE:"Space",CODE_PAGE_UP:"PageUp",CODE_PAGE_DOWN:"PageDown",CODE_END:"End",CODE_HOME:"Home",CODE_LEFT:"ArrowLeft",CODE_UP:"ArrowUp",CODE_RIGHT:"ArrowRight",CODE_DOWN:"ArrowDown",CODE_PRINTSCREEN:"PrintScreen",CODE_INSERT:"Insert",CODE_DELETE:"Delete",CODE_0:"Digit0",CODE_1:"Digit1",CODE_2:"Digit2",CODE_3:"Digit3",CODE_4:"Digit4",CODE_5:"Digit5",CODE_6:"Digit6",CODE_7:"Digit7",CODE_8:"Digit8",CODE_9:"Digit9",CODE_A:"KeyA",CODE_B:"KeyB",CODE_C:"KeyC",CODE_D:"KeyD",CODE_E:"KeyE",CODE_F:"KeyF",CODE_G:"KeyG",CODE_H:"KeyH",CODE_I:"KeyI",CODE_J:"KeyJ",CODE_K:"KeyK",CODE_L:"KeyL",CODE_M:"KeyM",CODE_N:"KeyN",CODE_O:"KeyO",CODE_P:"KeyP",CODE_Q:"KeyQ",CODE_R:"KeyR",CODE_S:"KeyS",CODE_T:"KeyT",CODE_U:"KeyU",CODE_V:"KeyV",CODE_W:"KeyW",CODE_X:"KeyX",CODE_Y:"KeyY",CODE_Z:"KeyZ",CODE_META_LEFT:"MetaLeft",CODE_OS_LEFT:"OSLeft",CODE_META_RIGHT:"MetaRight",CODE_OS_RIGHT:"OSRight",CODE_CONTEXT_MENU:"ContextMenu",CODE_NUMPAD0:"Numpad0",CODE_NUMPAD1:"Numpad1",CODE_NUMPAD2:"Numpad2",CODE_NUMPAD3:"Numpad3",CODE_NUMPAD4:"Numpad4",CODE_NUMPAD5:"Numpad5",CODE_NUMPAD6:"Numpad6",CODE_NUMPAD7:"Numpad7",CODE_NUMPAD8:"Numpad8",CODE_NUMPAD9:"Numpad9",CODE_NUMPAD_MULTIPLY:"NumpadMultiply",CODE_NUMPAD_ADD:"NumpadAdd",CODE_NUMPAD_SUBTRACT:"NumpadSubtract",CODE_NUMPAD_DECIMAL:"NumpadDecimal",CODE_NUMPAD_DIVIDE:"NumpadDivide",CODE_NUMPAD_ENTER:"NumpadEnter",CODE_F1:"F1",CODE_F2:"F2",CODE_F3:"F3",CODE_F4:"F4",CODE_F5:"F5",CODE_F6:"F6",CODE_F7:"F7",CODE_F8:"F8",CODE_F9:"F9",CODE_F10:"F10",CODE_F11:"F11",CODE_F12:"F12",CODE_F13:"F13",CODE_F14:"F14",CODE_F15:"F15",CODE_F16:"F16",CODE_F17:"F17",CODE_F18:"F18",CODE_F19:"F19",CODE_F20:"F20",CODE_F21:"F21",CODE_F22:"F22",CODE_F23:"F23",CODE_F24:"F24",CODE_NUM_LOCK:"NumLock",CODE_SCROLL_LOCK:"ScrollLock",CODE_SEMICOLON:"Semicolon",CODE_COMMA:"Comma",CODE_PERIOD:"Period",CODE_SLASH:"Slash",CODE_BACK_QUOTE:"Backquote",CODE_OPEN_BRACKET:"BracketLeft",CODE_BACK_SLASH:"Backslash",CODE_CLOSE_BRACKET:"BracketRight",CODE_QUOTE:"Quote"},G=(e,t)=>Object.keys(e).find((a=>e[a]===t));function Z(e){return t=>{const a=G(H,t);e.keys[a]=!0}}function W(e){return t=>{const a=G(H,t);e.keys[a]=!1}}function j(e){return()=>{Object.keys(e.keys).forEach((t=>{e.keys[t]=!1}))}}class Q{constructor(e,a,n){t(this,"x"),t(this,"y"),t(this,"data"),this.x=e,this.y=a,this.data=n}}var z,X,q,$,J,ee,te,ae;(X=z||(z={})).FRONT="FRONT",X.MIDDLE="MIDDLE",X.BACKGROUND="BACKGROUND";class ne{constructor(e,a,n,r,l=null,o="#ffffff00"){t(this,"image"),t(this,"url"),t(this,"key"),t(this,"layer"),t(this,"tileSpriteId"),t(this,"color"),this.image=l,this.url=r,this.key=e,this.layer=a,this.tileSpriteId=n,this.color=o}}class re{constructor(e,a,n){t(this,"layer"),t(this,"point"),t(this,"data"),this.point=e,this.data=n,this.layer=a}}class le{constructor(e,a,n,r=null){t(this,"image"),t(this,"prefabId"),t(this,"width"),t(this,"height"),this.prefabId=e,this.width=a,this.height=n,this.image=r}}class oe{constructor(e,a){t(this,"point"),t(this,"data"),this.point=e,this.data=a}}($=q||(q={})).TILE="TILE",$.PREFAB="PREFAB",(ee=J||(J={})).PEN="PEN",ee.ERASER="ERASER",ee.PIPETA="PIPETA",ee.AREA_PEN="AREA_PEN",ee.AREA_ERASER="AREA_ERASER",ee.START="START",(ae=te||(te={})).DRAW="DRAW",ae.DELETE="DELETE";function ie(e,t,a){if(!e||0===e.length)return[];if(a<t){const e=a;a=t,t=e}if(t<=e[0]&&a>=e[e.length-1])return e;if(t==a)return t<=e[0]||a>=e[e.length-1]?[]:[e[se(e,t)]];let n=-1,r=e.length;return n=e[0]>=t?0:se(e,t),r=e[e.length-1]<=a?e.length:function(e,t){let a=0,n=e.length-1;for(;a<=n;){const r=a+Math.floor((n-a)/2);if(e[r]>=t){if(0==r||e[r-1]<=t)return r;n=r-1}else a=r+1}return-1}(e,a),e.slice(n,r)}function se(e,t){let a=0,n=e.length-1;for(;a<=n;){const r=a+Math.floor((n-a)/2);if(e[r]>t)n=r-1;else{if(0==r||r+1<e.length-1&&e[r+1]>=t)return r;a=r+1}}return-1}function ce(e,t,a){const n=e.getBoundingClientRect();return{x:t-n.left-(n.width-e.width)/2,y:a-n.top-(n.height-e.height)/2}}function ue(e,t,a,n,r){return{x:n*e+t,y:-r*e+a}}var de={windowToCanvas:ce,pixToCoordinate:function(e,t,a,n,r,l){const o=ce(e,r,l),i=o.x-a,s=o.y-n;return{x:Math.floor(i/t),y:-Math.floor(s/t)}},canvasPixToCoordinate:function(e,t,a,n,r){const l=n-t,o=r-a;return{x:Math.floor(l/e),y:-Math.floor(o/e)}},CoordinateToPix:ue};var Ee={DEFAULT_SIZE:32,MIN_SIZE:22,MAX_SIZE:50,CANVAS_WIDTH:1100,CANVAS_HEIGHT:780,BLOCK_SIZE:5,Start_Point_Color:"#fff100"};var _e=(e,t)=>{const a=e<0,n=t<0,r=1+~~Math.abs((a?e+1:e)/Ee.BLOCK_SIZE),l=1+~~Math.abs((n?t+1:t)/Ee.BLOCK_SIZE);return{x:r*Ee.BLOCK_SIZE*(a?-1:1)-(a?0:1),y:l*Ee.BLOCK_SIZE*(n?-1:1)-(n?0:1)}},fe=(e,t)=>{const a=(e<0?e+1:e)%Ee.BLOCK_SIZE,n=(t<0?t+1:t)%Ee.BLOCK_SIZE;return{x:Math.abs(a),y:Math.abs(n)}};function pe(e){return()=>{if(!e.tile.image)return;let t;if(e.tile.isCollect){if(!e.tile.key){let t=Math.ceil(1e4*Math.random());for(;e.currentTileInstancesCache.has(t+"");)t=Math.ceil(1e4*Math.random());const a=t+"";e.tile.key=a}t=e.currentTileInstancesCache.get(e.tile.key),t||(t=new ne(e.tile.key,e.currentLayer,e.tile.spriteId,e.tile.path,e.tile.image),e.currentTileInstancesCache.set(e.tile.key,t))}else{let a=Math.ceil(1e4*Math.random());for(;e.currentTileInstancesCache.has(a+"");)a=Math.ceil(1e4*Math.random());const n=a+"";t=new ne(n,e.currentLayer,e.tile.spriteId,e.tile.path,e.tile.image),e.tile.key=n,e.currentTileInstancesCache.set(n,t)}return t}}function he(e){return t=>{const a=e.mapTiles.get(t.y);if(null!=a)return a.get(t.x)}}function ye(e){return(t,a)=>{const n=[...e.mapTiles.keys()],r=n.length>5?ie(n,t.y,a.y):n,l=[];for(let o=0;o<r.length;o++){const n=e.mapTiles.get(r[o]);if(null==n)continue;const i=[...n.keys()],s=i.length>5?ie(i,t.x,a.x):i;for(let e=0;e<s.length;e++)l.push(n.get(s[e]))}return l}}function Ae(e){return t=>{const a=_e(t.x,t.y),n=e.mapBlocks.get(a.y);return null==n?null:n.get(a.x)}}function Ce(e){return()=>{const t=e.prefabInstancesCache.get(e.prefab.prefabId);return t?(e.prefabInstancesCache.set(e.prefab.prefabId,t),t):new le(e.prefab.prefabId,e.prefab.width,e.prefab.height,e.prefab.image)}}function De(e){return t=>{const a=_e(t.x,t.y),n=e.mapBlocks.get(a.y);if(null==n)return;const r=n.get(a.x);if(null==r)return;const l=fe(t.x,t.y),o=r.data[l.x][l.y];return-1!==o?e.prefabInstances.get(o):void 0}}function Le(e){return(t,a)=>{if(0==e.blockInPrefabCount.size)return;const n={x:Math.min(t.x,a.x),y:Math.min(t.y,a.y)},r={x:Math.max(t.x,a.x),y:Math.max(t.y,a.y)+Ee.BLOCK_SIZE},l=_e(n.x,n.y),o=_e(r.x,r.y),i=[...e.blockInPrefabCount.keys()];let s;if(l.y==o.y){if(!e.blockInPrefabCount.has(l.y))return;s=[l.y]}else s=ie(i,l.y,o.y);const c=[],u=new Set;for(let d=0;d<s.length;d++){const t=e.blockInPrefabCount.get(s[d]);if(null==t)continue;const a=[...t.keys()];let i;if(l.x==o.x){if(!t.has(l.x))return;i=[l.x]}else i=ie(a,l.x,o.x);for(let l=0;l<i.length;l++){const a=t.get(i[l]);if(a)for(const t of a){if(u.has(t))continue;u.add(t);const a=e.prefabInstances.get(t);a&&(me({x:a.point.x,y:a.point.y-a.data.height,width:a.data.width,height:a.data.height},{x:n.x,y:n.y,width:r.x-n.x,height:r.y-n.y})&&c.push(a))}}}return c}}function me(e,t){const a=e.x,n=e.y,r=e.x+e.width,l=e.y+e.height,o=t.x,i=t.y,s=t.x+t.width,c=t.y+t.height;return a<=s&&r>=o&&n<=c&&l>=i}function ge(e){return t=>{e.startPoint=t}}function be(e){return t=>{if(!e.tile.image)return;let n;if(e.tile.isCollect){if(!e.tile.key){let t=Math.ceil(1e4*Math.random());for(;e.tileInstancesCache.has(t+"");)t=Math.ceil(1e4*Math.random());const a=t+"";e.tile.key=a}n=e.tileInstancesCache.get(e.tile.key),n||(n=new ne(e.tile.key,e.currentLayer,e.tile.spriteId,e.tile.path,e.tile.image),e.tileInstancesCache.set(e.tile.key,n))}else{let t=Math.ceil(1e4*Math.random());for(;e.tileInstancesCache.has(t+"");)t=Math.ceil(1e4*Math.random());const a=t+"";n=new ne(a,e.currentLayer,e.tile.spriteId,e.tile.path,e.tile.image),e.tile.isCollect=!0,e.tile.key=a,e.tileInstancesCache.set(a,n)}e.mapTiles.has(t.y)||e.mapTiles.set(t.y,new a(((e,t)=>e-t)));const r=e.mapTiles.get(t.y),l=new re(t,e.currentLayer,n);return null==r||r.set(t.x,l),l}}function Ue(e){return(t,a)=>{let n,r,l,o,i;t.x>a.x?(r=t.x,l=a.x):(r=a.x,l=t.x),t.y>a.y?(o=t.y,i=a.y):(o=a.y,i=t.y);for(let s=l;s<=r;s++)for(let t=i;t<=o;t++)n=be(e)({x:s,y:t});return null==n?void 0:n.data}}function Oe(e){return t=>{if(!e.mapTiles.has(t.y))return;const a=e.mapTiles.get(t.y);0!=(null==a?void 0:a.size)?null==a||a.delete(t.x):e.mapTiles.delete(t.y)}}function Te(e){return(t,a)=>{let n,r,l,o;t.x>a.x?(n=t.x,r=a.x):(n=a.x,r=t.x),t.y>a.y?(l=t.y,o=a.y):(l=a.y,o=t.y);for(let i=r;i<=n;i++)for(let t=o;t<=l;t++)Oe(e)({x:i,y:t})}}function Ie(e){return t=>{const n=e.prefab.width,r=e.prefab.height;if(function(e,t,a){t={x:Math.min(t.x,a.x),y:Math.min(t.y,a.y)},a={x:Math.max(t.x,a.x),y:Math.max(t.y,a.y)};for(let n=t.x;n<a.x;n++)for(let r=a.y;r>t.y;r--)if(De(e)({x:n,y:r}))return!0;return!1}(e,{x:t.x,y:t.y-r},{x:t.x+n,y:t.y}))return;let l,o=Math.ceil(1e4*Math.random());for(;e.prefabInstances.has(o);)o=Math.ceil(1e4*Math.random());const i=e.prefabInstancesCache.get(e.prefab.prefabId);if(null==i){const a=new le(e.prefab.prefabId,e.prefab.width,e.prefab.height,e.prefab.image);e.prefabInstancesCache.set(e.prefab.prefabId,a),l=new oe(t,a),e.prefabInstances.set(o,l)}else l=new oe(t,i),e.prefabInstances.set(o,l);for(let s=0;s<n;s++)for(let n=0;n<r;n++){const r={x:t.x+s,y:t.y-n};let l=Ae(e)(r);const i=_e(r.x,r.y);if(!l){const t=[];for(let e=0;e<Ee.BLOCK_SIZE;e++){const e=[];for(let t=0;t<Ee.BLOCK_SIZE;t++)e.push(-1);t.push(e)}const n=new Q(i.x,i.y,t);let r=e.mapBlocks.get(i.y);r||(e.mapBlocks.set(i.y,new a(((e,t)=>e-t))),r=e.mapBlocks.get(i.y)),null==r||r.set(i.x,n),l=n}const c=fe(r.x,r.y);l.data[c.x][c.y]=o,Ke(e,o,i)}return l}}function Ke(e,t,n){let r=e.blockInPrefabCount.get(n.y);r||(e.blockInPrefabCount.set(n.y,new a(((e,t)=>e-t))),r=e.blockInPrefabCount.get(n.y));let l=r.get(n.x);null==l&&(l=new Set),l.add(t),r.set(n.x,l)}function Ve(e){return t=>{const a=_e(t.x,t.y),n=e.mapBlocks.get(a.y);if(null==n)return;const r=n.get(a.x);if(null==r)return;const l=fe(t.x,t.y),o=r.data[l.x][l.y];if(-1===o)return;const i=e.prefabInstances.get(o);if(i){const t=i.point,a=i.data.width,n=i.data.height,r=new Set;for(let l=t.x;l<t.x+a;l++)for(let a=t.y;a<t.y+n;a++){const t=_e(l,a);if(r.has(ke(t)))continue;r.add(ke(t));const n=e.blockInPrefabCount.get(t.y),i=null==n?void 0:n.get(t.x);i&&(i.delete(o),0===i.size&&(null==n||n.delete(t.x))),0===(null==n?void 0:n.size)&&e.blockInPrefabCount.delete(t.y);const s=e.mapBlocks.get(t.y);if(null==s)continue;const c=s.get(t.x);if(null==c)continue;for(let e=0;e<c.data.length;e++)for(let t=0;t<c.data[0].length;t++)c.data[e][t]===o&&(c.data[e][t]=-1);let u=!0;for(let e=0;e<c.data.length;e++){for(let t=0;t<c.data[0].length;t++)if(-1!==c.data[e][t]){u=!1;break}if(!u)break}u&&s.delete(t.x),0===s.size&&e.mapBlocks.delete(t.y)}}return e.prefabInstances.delete(o),i}}function ve(e){return()=>{e.tileInstancesCache.clear(),e.currentTileInstancesCache.clear()}}function Pe(e){return t=>{e.tileInstancesCache.set(t.key,t),e.currentTileInstancesCache.set(t.key,t)}}function Fe(e){return()=>{e.mapTiles.clear()}}function xe(e){return t=>{e.mapTiles.has(t.point.y)||e.mapTiles.set(t.point.y,new a(((e,t)=>e-t)));const n=e.mapTiles.get(t.point.y);null==n||n.set(t.point.x,t)}}function Se(e){return()=>{e.prefabInstancesCache.clear(),e.mapBlocks.clear(),e.blockInPrefabCount.clear(),e.prefabInstances.clear()}}function Me(e){return t=>{const n=Math.ceil(1e4*Math.random()),r=t.data.width,l=t.data.height;e.prefabInstancesCache.set(t.data.prefabId,t.data),e.prefabInstances.set(n,t);for(let o=0;o<r;o++)for(let r=0;r<l;r++){const l={x:t.point.x+o,y:t.point.y-r};let i=Ae(e)(l);const s=_e(l.x,l.y);if(!i){const t=[];for(let e=0;e<Ee.BLOCK_SIZE;e++){const e=[];for(let t=0;t<Ee.BLOCK_SIZE;t++)e.push(-1);t.push(e)}const n=new Q(s.x,s.y,t);let r=e.mapBlocks.get(s.y);r||(e.mapBlocks.set(s.y,new a(((e,t)=>e-t))),r=e.mapBlocks.get(s.y)),null==r||r.set(s.x,n),i=n}const c=fe(l.x,l.y);i.data[c.x][c.y]=n,Ke(e,n,s)}}}function ke(e){return`${e.x}-${e.y}`}const Ne=n();function we(e){return t=>{e.tile=t,e.itemType=q.TILE,Ne.emit("init")}}function Re(e){return t=>{e.prefab=t,e.itemType=q.PREFAB,Ne.emit("init")}}function Ye(e){return t=>{e.currentTool=t,Ne.emit("init")}}function Be(e){return t=>{e.currentPrefabTool=t,Ne.emit("init")}}function He(e){return t=>{e.displayLayers=t,Ne.emit("refreshCanvas")}}function Ge(e){return(t,a,n)=>{e.bgUrl=a,e.bgId=t,e.bgName=n}}function Ze(e){return()=>{e.bgUrl="",e.bgId="",e.bgName=""}}function We(e){return(t,a)=>{const n=e.tileInstancesCache.get(t);n&&a&&(n.color=a)}}function je(e){return(t,a)=>{e.effects.set(t,a)}}const Qe={canvasSize:Ee.DEFAULT_SIZE,initPoint:{x:Ee.CANVAS_WIDTH/2,y:Ee.CANVAS_HEIGHT/2},dragging:!1,showGrid:!0,showAxis:!0,keys:(()=>{const e={};return Object.keys(H).forEach((t=>{e[t]=!1})),e})(),startPoint:{x:5,y:5},mapTiles:new a(((e,t)=>e-t)),blockInPrefabCount:new a(((e,t)=>e-t)),mapBlocks:new a(((e,t)=>e-t)),prefabInstancesCache:new Map,prefabInstances:new Map,currentTileInstancesCache:new Map,tile:{isCollect:!1,path:"",name:"",desc:"",key:"",spriteId:"",image:null},prefab:{path:"",name:"",desc:"",width:0,height:0,prefabId:"",image:null},itemType:q.TILE,currentLayer:z.MIDDLE,currentTool:J.AREA_PEN,displayLayers:new class{constructor(){t(this,"prefabShow"),t(this,"frontShow"),t(this,"middleShow"),t(this,"backgroundShow"),this.prefabShow=!0,this.frontShow=!0,this.middleShow=!0,this.backgroundShow=!0}},currentPrefabTool:te.DRAW,tileInstancesCache:new Map,bgUrl:"",bgId:"",bgName:"",effects:new Map};function ze(e){return()=>e.keys}function Xe(e){return()=>Object.entries(e.keys).filter((([,e])=>e)).map((e=>e[0]))}function qe(e){return()=>e.keys.VALUE_CONTROL&&e.keys.VALUE_Z}function $e(e){return()=>e.keys.VALUE_ALT}function Je(e){return()=>e.keys.VALUE_CONTROL&&e.keys.VALUE_S}function et(e){return()=>e.keys.VALUE_B}function tt(e){return()=>e.keys.VALUE_E}function at(e){return()=>e.keys.VALUE_F}function nt(e){return()=>e.keys.VALUE_P}function rt(e){return()=>e.keys.VALUE_U}function lt(e){return t=>{switch(t){case z.FRONT:return e.displayLayers.frontShow;case z.MIDDLE:return e.displayLayers.middleShow;case z.BACKGROUND:return e.displayLayers.backgroundShow}return!0}}function ot(e){return()=>[...e.tileInstancesCache.values()]}function it(e){return t=>e.tileInstancesCache.get(t)}const st=r(Qe),ct={canvasInit_X:k(ut=st),canvasInit_Y:N(ut),canvasModifyDragState:w(ut),canvasUpdateSize:S(ut),canvasUpdatePoint:M(ut),canvasCurrentLayer:R(ut),canvasShowGrid:Y(ut),canvasShowAxis:B(ut),keyboardKeyDown:Z(ut),keyboardKeyUp:W(ut),keyboardRefresh:j(ut),mapAddTile:be(ut),mapDeleteTile:Oe(ut),mapAddAreaTile:Ue(ut),mapDeleteAreaTile:Te(ut),mapAddPrefab:Ie(ut),mapDeletePrefab:Ve(ut),clearAllTileData:ve(ut),replaceTileData:Pe(ut),clearAllTile:Fe(ut),replaceTile:xe(ut),clearPrefabs:Se(ut),replacePrefab:Me(ut),mapSetStartPoint:ge(ut),currentTileModify:we(ut),currentPrefabModify:Re(ut),currentTool:Ye(ut),currentDisplayLayer:He(ut),currentPrefabTool:Be(ut),backgroundModify:Ge(ut),backgroundClear:Ze(ut),collectTileColor:We(ut),effectModify:je(ut)};var ut;const dt=function(e){return{selectKeys:ze(e),selectPressedKeys:Xe(e),isRecall:qe(e),isAlt:$e(e),isDown_B:et(e),isDown_E:tt(e),isDown_F:at(e),isDown_P:nt(e),isDown_U:rt(e),isSave:Je(e),getTileRange:ye(e),getTileByPoint:he(e),getPrefabByPoint:De(e),getPrefabRange:Le(e),getCurrentPrefabData:Ce(e),getCurrentTileData:pe(e),currentLayerIsDisplayed:lt(e),getAllCollectTile:ot(e),getCollectTileByKey:it(e)}}(st),Et=()=>({state:l(st),action:l(ct),getters:l(dt)}),_t=Et();function ft(){return{x:_t.state.startPoint.x,y:_t.state.startPoint.y,speed:6,jumpMin:1.5,jumpMax:2,jumpSpeed:8}}function pt(){return{bg_id:_t.state.bgId,color:"#fff"}}function ht(){const e=[],t=[..._t.state.prefabInstances.values()];for(const a of t)e.push({prefab_id:a.data.prefabId,x:a.point.x,y:a.point.y-a.data.height+1});return e}function yt(){const e=[],t=[..._t.state.tileInstancesCache.values()];for(const a of t){const t=_t.state.effects.get(a.key);e.push({key:a.key,layer:Ct(a.layer),tile_sprite_id:a.tileSpriteId,color:a.color,effect_keys:t||[]})}return e}function At(){const e=[],t=[..._t.state.mapTiles.values()];for(const a of t){const t=[...a.values()];for(const a of t)e.push({x:a.point.x,y:a.point.y,key:a.data.key,layer:Ct(a.layer)})}return e}function Ct(e){switch(e){case z.BACKGROUND:return 1;case z.MIDDLE:return 2;case z.FRONT:return 3}}function Dt(e){return new Promise(((t,a)=>{const n=o.create({baseURL:"https://happyserver.alsritter.icu/",timeout:5e3});n.interceptors.request.use((e=>e),(e=>(console.error("请求失败",e),Promise.reject(e)))),n(e).then((e=>{let a;a=null==e.data?JSON.parse(e.request.responseText):e.data,t(a)})).catch((e=>{a(e)}))}))}var Lt={getData:{getTileList:function(){return Dt({url:"/get-tiles"})},getPrefabList:function(){return Dt({url:"/get-prefabs"})},getBg:function(){return Dt({url:"/get-bg"})},getTileById:function(e){return Dt({url:`/get-tile-by-id/${e}`})},getPrefabById:function(e){return Dt({url:`/get-prefab-by-id/${e}`})},getBgById:function(e){return Dt({url:`/get-bg-by-id/${e}`})},getEffectList:function(){return Dt({url:"/get-effects"})},getEffectById:function(e){return Dt({url:`/get-effect-by-id/${e}`})}},sendData:{}};const mt=Et();function gt(e){const t=JSON.parse(e),a=t.background,n=t.initial,r=t.prefabs,l=t.tileData,o=t.tiles;n.x&&n.y&&mt.action.mapSetStartPoint({x:n.x,y:n.y}),async function(e,t,a,n){mt.action.clearAllTileData();for(const l of e)await Lt.getData.getTileById(l.tile_sprite_id).then((e=>{const t=new Image(100,200);t.src=e.path;const a=new ne(l.key,bt(l.layer),l.tile_sprite_id,e.path,t,l.color);mt.action.effectModify(l.key,l.effect_keys),mt.action.replaceTileData(a)})).catch((e=>{console.error(e)}));r=t,mt.action.clearAllTile(),r.forEach((e=>{const t={x:e.x,y:e.y},a=new re(t,bt(e.layer),mt.state.tileInstancesCache.get(e.key));mt.action.replaceTile(a)})),await async function(e){if(mt.action.backgroundClear(),!e.bg_id)return;await Lt.getData.getBgById(e.bg_id).then((t=>{const a=t.path,n=t.name;mt.action.backgroundModify(e.bg_id,a,n)})).catch((e=>{console.error(e)}))}(n),await async function(e){mt.action.clearPrefabs();for(const t of e)await Lt.getData.getPrefabById(t.prefab_id).then((e=>{const a=new Image(100,200);a.src=e.path;const n=e.width,r=e.height,l={x:t.x,y:t.y+r-1},o=new le(t.prefab_id,n,r,a),i=new oe(l,o);mt.action.replacePrefab(i)})).catch((e=>{console.error(e)}))}(a),Ne.emit("refreshCanvas");var r}(l,o,r,a)}function bt(e){switch(e){case 1:return z.BACKGROUND;case 2:return z.MIDDLE;case 3:return z.FRONT;default:return z.BACKGROUND}}const Ut=i({setup:(e,t)=>({loadTextFromFile:function(e){const a=e.target.files[0],n=new FileReader;n.onload=e=>{t.emit("load",e.target.result)},n.readAsText(a)}})});s("data-v-1f9f4796");const Ot={class:"text-reader"},Tt=E(" 导入地图 ");c(),Ut.render=function(e,t,a,n,r,l){return _(),u("label",Ot,[d("input",{type:"file",accept:"application/json",onChange:t[0]||(t[0]=(...t)=>e.loadTextFromFile&&e.loadTextFromFile(...t))},null,32),Tt])},Ut.__scopeId="data-v-1f9f4796";var It=i({setup(){const e=f(null);return Ne.on("unityRefresh",(()=>{var t;null==(t=e.value)||t.contentWindow.location.reload(!0),e.value.contentWindow.focus()})),{iframe:e}}});const Kt={ref:"iframe",src:"./unity/index.html",frameborder:"0",width:"960px",height:"650px",scrolling:"no"};It.render=function(e,t,a,n,r,l){return _(),u("div",null,[d("iframe",Kt,null,512)])};var Vt=i({components:{FileReader:Ut,EmbedUnity:It},setup(){const e=Et(),t=f(!1);return{gotoIndex:function(){},outputMapData:function(){if(!e.state.bgUrl)return void p.error("请先选择一个背景图片");!function(e,t){const a=document.createElement("a");a.style.visibility="hidden",document.body.appendChild(a);const n=new Blob([JSON.stringify(e)],{type:"data:application/json;charset=utf-8"}),r=URL.createObjectURL(n);a.href=r,a.download=t,a.click(),document.body.removeChild(a)}({create_time:"2021-05-01T12:53Z",version:"1.1",author:"alsritter",initial:ft(),background:pt(),prefabs:ht(),tileData:yt(),tiles:At()},"exportData.json")},inputMapData:function(e){gt(e)},clearLocal:function(){localStorage.removeItem("localMapData")},openUnity:function(){Ne.emit("unityRefresh"),t.value=!0},dialogVisible:t}}});s("data-v-6d0de1fe");const vt={class:"index-header"},Pt={class:"limit-box"},Ft=E("清空本地数据"),xt=E("导出数据"),St=E("打开 Unity");c(),Vt.render=function(e,t,a,n,r,l){const o=h("el-button"),i=h("file-reader"),s=h("embed-unity"),c=h("el-dialog");return _(),u("div",vt,[d("div",Pt,[y(o,{size:"mini",type:"warning",onClick:e.clearLocal},{default:A((()=>[Ft])),_:1},8,["onClick"]),y(o,{size:"mini",type:"primary",onClick:e.outputMapData},{default:A((()=>[xt])),_:1},8,["onClick"]),y(o,{size:"mini",onClick:e.openUnity},{default:A((()=>[St])),_:1},8,["onClick"]),y(i,{onLoad:e.inputMapData},null,8,["onLoad"]),y(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=t=>e.dialogVisible=t),width:"1000px"},{default:A((()=>[y(s)])),_:1},8,["modelValue"])])])},Vt.__scopeId="data-v-6d0de1fe";var Mt=i({setup(){var e;const t=Et(),a=f([]),n=f([]),r=C((()=>t.state.tile.key));return null==(e=t.state.effects.get(r.value))||e.forEach((e=>{a.value.push(e)})),Lt.getData.getEffectList().then((e=>{n.value=[];for(const t of e)n.value.push({value:t.effect_id,label:t.effect})})).catch((e=>{console.error(e)})),D(a,(e=>{if(e){if(!r.value)return;const a=[];for(const t of e)a.push(t);t.action.effectModify(r.value,a)}})),D((()=>t.state.tile.key),(e=>{if(e){a.value=[];const n=t.state.effects.get(e);if(!n)return;for(const e of n)a.value.push(e)}})),{effects:n,eff:a}}});Mt.render=function(e,t,a,n,r,l){const o=h("el-option"),i=h("el-select");return _(),u("div",null,[y(i,{modelValue:e.eff,"onUpdate:modelValue":t[0]||(t[0]=t=>e.eff=t),multiple:"",placeholder:"选择 Tile 携带效果"},{default:A((()=>[(_(!0),u(L,null,m(e.effects,(e=>(_(),g(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])};var kt=i({setup(){const e=Et(),t=f([]);return Lt.getData.getTileList().then((e=>{t.value=e})).catch((e=>{console.error(e)})),{items:t,selectedTile:function(t,a){e.action.currentTileModify({isCollect:!1,spriteId:a.spriteId,key:"",path:a.path,name:a.name,desc:a.desc,image:t.target})},loadImage:function(e){}}}});s("data-v-0a3b57f2");const Nt={class:"tile-list"};c(),kt.render=function(e,t,a,n,r,l){const o=h("el-image");return _(),u("div",Nt,[(_(!0),u(L,null,m(e.items,(t=>(_(),g(o,{key:t.name,src:t.path,title:t.desc,lazy:"",onClick:a=>e.selectedTile(a,t),onLoad:e.loadImage},null,8,["src","title","onClick","onLoad"])))),128))])},kt.__scopeId="data-v-0a3b57f2";var wt=i({setup(){const e=Et(),t=f([]);return Lt.getData.getPrefabList().then((e=>{t.value=e})).catch((e=>{console.error(e)})),{items:t,selectedPrefab:function(t,a){e.action.currentPrefabModify({prefabId:a.prefabId,width:a.width,height:a.height,path:a.path,name:a.name,desc:a.desc,image:t.target})}}}});s("data-v-543758fb");const Rt={class:"prefab-list"};c(),wt.render=function(e,t,a,n,r,l){const o=h("el-image");return _(),u("div",Rt,[(_(!0),u(L,null,m(e.items,(t=>(_(),g(o,{key:t.name,src:t.path,title:t.desc,fit:"contain",onClick:a=>e.selectedPrefab(a,t)},null,8,["src","title","onClick"])))),128))])},wt.__scopeId="data-v-543758fb";var Yt=i({setup(){const e=Et(),t=f(!0),a=f(!0),n=f("AREA_PEN"),r=f("DRAW");return D(t,(t=>{Ne.emit("refreshCanvas"),e.action.canvasShowGrid(t)})),D(a,(t=>{Ne.emit("refreshCanvas"),e.action.canvasShowAxis(t)})),D(n,(t=>{e.action.currentTool(t)})),D(r,(t=>{e.action.currentPrefabTool(t)})),D((()=>e.getters.isDown_B()),(t=>{t&&(e.action.currentTool(J.PEN),n.value="PEN")})),D((()=>e.getters.isDown_E()),(t=>{t&&(e.action.currentTool(J.ERASER),n.value="ERASER")})),D((()=>e.getters.isDown_F()),(t=>{t&&(e.action.currentTool(J.PIPETA),n.value="PIPETA")})),D((()=>e.getters.isDown_P()),(t=>{t&&(e.action.currentTool(J.AREA_PEN),n.value="AREA_PEN")})),D((()=>e.getters.isDown_U()),(t=>{t&&(e.action.currentTool(J.AREA_ERASER),n.value="AREA_ERASER")})),{showGrid:t,showAxis:a,brush:n,store:e,prefabModel:r}}});s("data-v-a3f6d6d8");const Bt={class:"tool-select"},Ht={class:"canvas-set"},Gt={key:0},Zt=E("铅笔|B"),Wt=E("橡皮|E"),jt=E("滴灌|F"),Qt=E("选框笔|P"),zt=E("选框擦|U"),Xt=E("设置起点"),qt={key:1},$t=E("绘制|Q"),Jt=E("删除|D");c(),Yt.render=function(e,t,a,n,r,l){const o=h("el-checkbox"),i=h("el-radio"),s=h("el-col"),c=h("el-row");return _(),u("div",Bt,[d("div",Ht,[y(o,{modelValue:e.showGrid,"onUpdate:modelValue":t[0]||(t[0]=t=>e.showGrid=t),label:"显示网格"},null,8,["modelValue"]),y(o,{modelValue:e.showAxis,"onUpdate:modelValue":t[1]||(t[1]=t=>e.showAxis=t),label:"显示轴线"},null,8,["modelValue"])]),"TILE"==e.store.state.itemType?(_(),u("div",Gt,[d("div",null,[y(c,{gutter:24},{default:A((()=>[y(s,{span:8},{default:A((()=>[y(i,{modelValue:e.brush,"onUpdate:modelValue":t[2]||(t[2]=t=>e.brush=t),label:"PEN"},{default:A((()=>[Zt])),_:1},8,["modelValue"])])),_:1}),y(s,{span:8},{default:A((()=>[y(i,{modelValue:e.brush,"onUpdate:modelValue":t[3]||(t[3]=t=>e.brush=t),label:"ERASER"},{default:A((()=>[Wt])),_:1},8,["modelValue"])])),_:1}),y(s,{span:8},{default:A((()=>[y(i,{modelValue:e.brush,"onUpdate:modelValue":t[4]||(t[4]=t=>e.brush=t),label:"PIPETA"},{default:A((()=>[jt])),_:1},8,["modelValue"])])),_:1})])),_:1})]),d("div",null,[y(c,{gutter:24},{default:A((()=>[y(s,{span:8},{default:A((()=>[y(i,{modelValue:e.brush,"onUpdate:modelValue":t[5]||(t[5]=t=>e.brush=t),label:"AREA_PEN"},{default:A((()=>[Qt])),_:1},8,["modelValue"])])),_:1}),y(s,{span:8},{default:A((()=>[y(i,{modelValue:e.brush,"onUpdate:modelValue":t[6]||(t[6]=t=>e.brush=t),label:"AREA_ERASER"},{default:A((()=>[zt])),_:1},8,["modelValue"])])),_:1}),y(s,{span:8},{default:A((()=>[y(i,{modelValue:e.brush,"onUpdate:modelValue":t[7]||(t[7]=t=>e.brush=t),label:"START"},{default:A((()=>[Xt])),_:1},8,["modelValue"])])),_:1})])),_:1})])])):(_(),u("div",qt,[y(i,{modelValue:e.prefabModel,"onUpdate:modelValue":t[8]||(t[8]=t=>e.prefabModel=t),label:"DRAW"},{default:A((()=>[$t])),_:1},8,["modelValue"]),y(i,{modelValue:e.prefabModel,"onUpdate:modelValue":t[9]||(t[9]=t=>e.prefabModel=t),label:"DELETE"},{default:A((()=>[Jt])),_:1},8,["modelValue"])]))])},Yt.__scopeId="data-v-a3f6d6d8";var ea=i({components:{TileList:kt,PrefabList:wt,EffectList:Mt,ToolSelect:Yt},setup(){const e=Et(),t=f("tiles"),a=f("#fff");return D((()=>e.state.tile.key),(t=>{var n;const r=null==(n=e.getters.getCollectTileByKey(e.state.tile.key))?void 0:n.color;r&&(a.value=r)})),{activeName:t,store:e,color:a}}});s("data-v-ddca2506");const ta={class:"index-aside"},aa={key:0},na=E("选中道具"),ra={key:0},la=d("br",null,null,-1),oa={key:0},ia={key:1},sa=E("画布属性"),ca=E("    ");c(),ea.render=function(e,t,a,n,r,l){const o=h("tile-list"),i=h("el-tab-pane"),s=h("prefab-list"),c=h("el-tabs"),E=h("el-card"),f=h("el-divider"),p=h("el-image"),C=h("el-col"),D=h("effect-list"),L=h("el-row"),m=h("tool-select");return _(),u("div",ta,[y(E,{class:"selector-box"},{default:A((()=>[y(c,{modelValue:e.activeName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.activeName=t),type:"border-card"},{default:A((()=>[y(i,{label:"单砖块",name:"tiles"},{default:A((()=>[y(o)])),_:1}),y(i,{label:"预制件",name:"prefab"},{default:A((()=>[y(s)])),_:1})])),_:1},8,["modelValue"])])),_:1}),y(E,{class:"info-box"},{default:A((()=>[d("div",null,[e.store.state.tile.path||e.store.state.prefab.path?(_(),u("div",aa,[y(f,null,{default:A((()=>[na])),_:1}),"TILE"==e.store.state.itemType?(_(),u("div",ra,[y(L,{gutter:24},{default:A((()=>[y(C,{span:7},{default:A((()=>[y(p,{src:e.store.state.tile.path},null,8,["src"])])),_:1}),y(C,{span:17},{default:A((()=>[d("div",null,[d("div",null,"编号："+b(e.store.state.tile.spriteId),1),la,e.store.state.tile.isCollect?U("",!0):(_(),u("div",oa,[d("div",null,"名称："+b(e.store.state.tile.name),1),d("div",null,"详情："+b(e.store.state.tile.desc),1)])),O(d("div",null,[y(D)],512),[[T,e.store.state.tile.isCollect]])])])),_:1})])),_:1})])):(_(),u("div",ia,[y(L,{gutter:24},{default:A((()=>[y(C,{span:7},{default:A((()=>[y(p,{src:e.store.state.prefab.path},null,8,["src"])])),_:1}),y(C,{span:17},{default:A((()=>[d("div",null,[d("div",null,"编号："+b(e.store.state.prefab.prefabId),1),d("div",null,"名称："+b(e.store.state.prefab.name),1),d("div",null,"详情："+b(e.store.state.prefab.desc),1),d("div",null,"宽度："+b(e.store.state.prefab.width),1),d("div",null,"高度："+b(e.store.state.prefab.height),1)])])),_:1})])),_:1})]))])):U("",!0),y(f,null,{default:A((()=>[sa])),_:1}),d("span",null,"x: "+b(e.store.state.initPoint.x)+"-",1),d("span",null,"y: "+b(e.store.state.initPoint.y),1),ca,d("span",null,"画布大小："+b(Math.round(e.store.state.canvasSize/32*100))+" %",1)])])),_:1}),y(E,null,{default:A((()=>[y(m)])),_:1})])},ea.__scopeId="data-v-ddca2506";var ua=i({setup(){const e=Et(),t=f([]),a=f("");return Lt.getData.getBg().then((e=>{t.value=e})).catch((e=>{console.error(e)})),{items:t,radioValue:a,changeBG:function(t){e.action.backgroundModify(t.bg_id,t.path,t.name)}}}});s("data-v-2bbe72a4");const da={class:"bg-list"},Ea=E("选择背景图片");c(),ua.render=function(e,t,a,n,r,l){const o=h("el-radio"),i=h("el-button"),s=h("el-popover");return _(),u("div",da,[y(s,{placement:"left",trigger:"click"},{reference:A((()=>[y(i,null,{default:A((()=>[Ea])),_:1})])),default:A((()=>[(_(!0),u(L,null,m(e.items,(a=>(_(),g(o,{key:a.name,modelValue:e.radioValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.radioValue=t),label:a.bg_id,onChange:t=>e.changeBG(a)},{default:A((()=>[E(b(a.name),1)])),_:2},1032,["modelValue","label","onChange"])))),128))])),_:1})])},ua.__scopeId="data-v-2bbe72a4";var _a=i({setup(){const e=Et(),t=f("0"),a=r({prefabShow:!0,frontShow:!0,middleShow:!0,backgroundShow:!0});return D(a,(()=>{e.action.currentDisplayLayer(a)})),D(t,(()=>{switch(t.value){case"0":e.action.canvasCurrentLayer(z.FRONT);break;case"1":e.action.canvasCurrentLayer(z.MIDDLE);break;case"2":e.action.canvasCurrentLayer(z.BACKGROUND)}})),{layer:t,display:a}}});s("data-v-53040f18");const fa={id:"showType"},pa=E("选择修改的层"),ha=d("br",null,null,-1),ya={class:"layer-show"},Aa={class:"layer-select"},Ca=d("input",{type:"radio",name:"layerRadio"},null,-1),Da=d("label",{id:"s-prefab"},"预制件",-1),La=d("label",{for:"s-front"},"前景装饰",-1),ma=d("label",{for:"s-middle"},"瓦片层",-1),ga=d("label",{for:"s-background"},"背景装饰",-1);c(),_a.render=function(e,t,a,n,r,l){const o=h("el-divider"),i=h("el-checkbox");return _(),u("div",fa,[y(o,null,{default:A((()=>[pa])),_:1}),ha,d("div",ya,[y(i,{modelValue:e.display.prefabShow,"onUpdate:modelValue":t[0]||(t[0]=t=>e.display.prefabShow=t)},null,8,["modelValue"]),y(i,{modelValue:e.display.frontShow,"onUpdate:modelValue":t[1]||(t[1]=t=>e.display.frontShow=t)},null,8,["modelValue"]),y(i,{modelValue:e.display.middleShow,"onUpdate:modelValue":t[2]||(t[2]=t=>e.display.middleShow=t)},null,8,["modelValue"]),y(i,{modelValue:e.display.backgroundShow,"onUpdate:modelValue":t[3]||(t[3]=t=>e.display.backgroundShow=t)},null,8,["modelValue"])]),d("div",Aa,[Ca,Da,O(d("input",{id:"s-front","onUpdate:modelValue":t[4]||(t[4]=t=>e.layer=t),type:"radio",name:"layerRadio",value:"0"},null,512),[[I,e.layer]]),La,O(d("input",{id:"s-middle","onUpdate:modelValue":t[5]||(t[5]=t=>e.layer=t),type:"radio",checked:"true",name:"layerRadio",value:"1"},null,512),[[I,e.layer]]),ma,O(d("input",{id:"s-background","onUpdate:modelValue":t[6]||(t[6]=t=>e.layer=t),type:"radio",name:"layerRadio",value:"2"},null,512),[[I,e.layer]]),ga])])},_a.__scopeId="data-v-53040f18";var ba=i({setup(){const e=Et();return{items:C((()=>e.getters.getAllCollectTile())),selectedTile:function(t,a){e.action.currentTileModify({isCollect:!0,spriteId:a.tileSpriteId,key:a.key,path:a.url,name:"",desc:"",image:a.image})}}}});s("data-v-19873fee");const Ua=d("span",null,"当前已选的 Tile",-1),Oa={class:"current-tile"};c(),ba.render=function(e,t,a,n,r,l){const o=h("el-image");return _(),u(L,null,[Ua,d("div",Oa,[(_(!0),u(L,null,m(e.items,(t=>(_(),g(o,{key:t.key,src:t.url,title:t.key,onClick:a=>e.selectedTile(a,t)},{default:A((()=>[E(b(t.key),1)])),_:2},1032,["src","title","onClick"])))),128))])],64)},ba.__scopeId="data-v-19873fee";var Ta=i({components:{LayerSelect:_a,CollectList:ba,BackgroundSelect:ua},setup:()=>({store:Et()})});s("data-v-e8367c52");const Ia={class:"index-aside"},Ka=E("背景信息");c(),Ta.render=function(e,t,a,n,r,l){const o=h("collect-list"),i=h("el-card"),s=h("layer-select"),c=h("background-select"),E=h("el-divider");return _(),u("div",Ia,[y(i,{class:"box-card"},{default:A((()=>[y(o)])),_:1}),y(i,{class:"box-card"},{default:A((()=>[y(s)])),_:1}),y(i,{class:"box-card select-bg"},{default:A((()=>[y(c,{class:"bg-s"}),y(E,null,{default:A((()=>[Ka])),_:1}),d("span",null,"当前选中背景： "+b(e.store.state.bgName),1)])),_:1})])},Ta.__scopeId="data-v-e8367c52";var Va=i({setup:()=>({})});s("data-v-7fa195b2");const va={class:"index-footer"};c(),Va.render=function(e,t,a,n,r,l){return _(),u("div",va,"© 2021 Alsritter")},Va.__scopeId="data-v-7fa195b2";var Pa=i({name:"App",components:{IndexHeader:Vt,IndexLeftAside:ea,IndexRightAside:Ta,IndexFooter:Va},setup(){const e=Et(),t={init(){this.addEvents();const e=localStorage.getItem("localMapData");e&&gt(e),window.oncontextmenu=function(e){e.preventDefault()}},addEvents(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)},onKeyDown(a){a.preventDefault(),e.action.keyboardKeyDown(a.key),t.onShortcutKey()},onKeyUp(t){t.preventDefault(),e.action.keyboardKeyUp(t.key)},onShortcutKey(){if(e.getters.isRecall(),e.getters.isSave()){const e={create_time:"2021-05-01T12:53Z",version:"1.1",author:"alsritter",initial:ft(),background:pt(),prefabs:ht(),tileData:yt(),tiles:At()};localStorage.setItem("localMapData",JSON.stringify(e)),p.success("保存成功")}}},a={refresh(){e.action.keyboardRefresh()}};K((()=>{a.refresh()})),V((()=>{t.init()}))}});Pa.render=function(e,t,a,n,r,l){const o=h("index-header"),i=h("el-header"),s=h("index-left-aside"),c=h("el-aside"),u=h("router-view"),d=h("el-main"),E=h("el-container"),f=h("index-right-aside"),p=h("index-footer"),C=h("el-footer");return _(),g(E,null,{default:A((()=>[y(i,{height:"45px"},{default:A((()=>[y(o)])),_:1}),y(E,null,{default:A((()=>[y(c,{width:"450px"},{default:A((()=>[y(s)])),_:1}),y(E,null,{default:A((()=>[y(d,null,{default:A((()=>[y(u)])),_:1})])),_:1}),y(c,{width:"300px"},{default:A((()=>[y(f)])),_:1})])),_:1}),y(C,null,{default:A((()=>[y(p)])),_:1})])),_:1})};const Fa={},xa=[{path:"/",name:"Home",component:()=>{return e=()=>import("./MainCanvas.b50580ed.js"),(t=["assets/MainCanvas.b50580ed.js","assets/MainCanvas.204b01ad.css","assets/vendor.d1d4d144.js"])&&0!==t.length?Promise.all(t.map((e=>{if((e=`./${e}`)in Fa)return;Fa[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script",n.crossOrigin=""),n.href=e,document.head.appendChild(n),t?new Promise(((e,t)=>{n.addEventListener("load",e),n.addEventListener("error",t)})):void 0}))).then((()=>e())):e();var e,t}}],Sa=v({history:P(),routes:xa});F(Pa).use(Sa).use(x).mount("#app");export{ue as C,q as I,z as L,te as P,J as T,Ee as a,Ne as b,de as c,le as d,ne as e,Et as u};
